{% extends 'inventario/base.html' %}

{% block title %}Reporte de Stock Bajo - La Esquina del Shot{% endblock %}

{% block content %}

<div class="row g-4">
    <!-- Columna para el Gráfico -->
    <div class="col-lg-7">
        <div class="card shadow-sm border-danger h-100">
            <div class="card-header bg-danger text-white">
                <h3 class="h4 mb-0 fw-bold text-center">Gráfico de Stock Bajo</h3>
            </div>
            <div class="card-body d-flex align-items-center justify-content-center">
                <canvas id="stockChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Columna para la Tabla -->
    <div class="col-lg-5">
        <div class="card shadow-sm border-danger h-100">
            <div class="card-header bg-danger text-white">
                <h3 class="h4 mb-0 fw-bold text-center">Detalle de Stock</h3>
            </div>
            <div class="card-body">
                <p class="card-text text-center fw-bold">
                    Mostrando productos con <strong class="text-danger">{{ umbral }}</strong> unidades o menos.
                </p>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover mt-2">
                        <thead class="table-light text-center">
                            <tr>
                                <th scope="col" class="fw-bold">Producto</th>
                                <th scope="col" class="fw-bold">Stock</th>
                            </tr>
                        </thead>
                        <tbody class="text-center">
                            {% for producto in productos %}
                            <tr>
                                <td>{{ producto.nombre }}</td>
                                <td><strong class="text-danger fs-5">{{ producto.stock }}</strong></td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="2" class="p-4">
                                    <div class="alert alert-success mb-0">
                                        ¡Felicidades! No hay productos con stock bajo.
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const ctx = document.getElementById('stockChart');
        
        const labels = JSON.parse('{{ chart_labels|safe }}');
        const data = JSON.parse('{{ chart_data|safe }}');

        if (data.length === 0) return;

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Stock Actual',
                    data: data,
                    backgroundColor: 'rgba(220, 53, 69, 0.7)',
                    borderColor: 'rgba(220, 53, 69, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    title: {
                        display: true,
                        text: 'Nivel de Stock de Productos Críticos',
                        color: '#212529',
                        font: {
                            size: 18,
                            weight: 'bold'
                        }
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1,
                            color: '#212529',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        }
                    },
                    y: {
                        ticks: {
                            color: '#212529',
                             font: {
                                size: 14,
                                weight: 'bold'
                            }
                        }
                    }
                }
            }
        });
    });
</script>

{% endblock %}
